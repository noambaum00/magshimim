(function(i){function m(){m.done||(x=m.done=!0,y=!1,b.each(n,function(a){a._dom_loaded()}))}var t=[],p=Array.prototype,o=Object.prototype,z=p.slice,u=o.toString,v=o.hasOwnProperty,k=window.console,w=window.navigator,f=window.document,r=w.userAgent,A="https:"==f.location.protocol?"https://":"http://",o=i&&i.__SV||0,B=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,y=!B&&-1==r.indexOf("MSIE")&&-1==r.indexOf("Mozilla"),b={},H={api_host:A+"api.cooladata.com",loaded:function(){},img:!1,http_post:!1,
track_pageload:!1,cookie_expiration:365,disable_cookie:!1,cookie_name:"cd_user_id"},x=!1,C=p.forEach,p=Array.isArray,D={},E=b.each=function(a,c,d){if(null!=a)if(C&&a.forEach===C)a.forEach(c,d);else if(a.length===+a.length)for(var g=0,b=a.length;g<b&&!(g in a&&c.call(d,a[g],g,a)===D);g++);else for(g in a)if(v.call(a,g)&&c.call(d,a[g],g,a)===D)break};b.extend=function(a){E(z.call(arguments,1),function(c){for(var d in c)void 0!==c[d]&&(a[d]=c[d])});return a};b.isArray=p||function(a){return"[object Array]"===
u.call(a)};b.isFunction=function(a){try{return/^\s*\bfunction\b/.test(a)}catch(c){return!1}};b.isArguments=function(a){return!(!a||!v.call(a,"callee"))};b.toArray=function(a){return!a?[]:a.toArray?a.toArray():b.isArray(a)||b.isArguments(a)?z.call(a):b.values(a)};b.values=function(a){var c=[];if(null==a)return c;E(a,function(a){c[c.length]=a});return c};b.isObject=function(a){return a===Object(a)&&!b.isArray(a)};b.isUndefined=function(a){return void 0===a};b.isString=function(a){return"[object String]"==
u.call(a)};b.JSONEncode=function(a){var c=function(a){var d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var d=c[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},d=function(a,b){var h="",e=0,f=e="",f=0,i=h,l=[],j=b[a];j&&("object"===
typeof j&&"function"===typeof j.toJSON)&&(j=j.toJSON(a));switch(typeof j){case "string":return c(j);case "number":return isFinite(j)?String(j):"null";case "boolean":case "null":return String(j);case "object":if(!j)return"null";h+="    ";l=[];if("[object Array]"===u.apply(j)){f=j.length;for(e=0;e<f;e+=1)l[e]=d(e,j)||"null";return f=0===l.length?"[]":h?"[\n"+h+l.join(",\n"+h)+"\n"+i+"]":"["+l.join(",")+"]"}for(e in j)v.call(j,e)&&(f=d(e,j))&&l.push(c(e)+(h?": ":":")+f);return f=0===l.length?"{}":h?
"{"+l.join(",")+""+i+"}":"{"+l.join(",")+"}"}};return d("",{"":a})};b.strip_empty_properties=function(a){var c={};b.each(a,function(a,g){b.isString(a)&&0<a.length&&(c[g]=a)});return c};b.base64Encode=function(a){var c={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){for(var g="",b,h,e,f,i,l,j=0,a=c._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),h=a.charCodeAt(j++),e=a.charCodeAt(j++),f=b>>2,b=(b&3)<<4|h>>4,i=(h&15)<<2|e>>6,l=e&63,isNaN(h)?i=l=64:isNaN(e)&&
(l=64),g=g+this._keyStr.charAt(f)+this._keyStr.charAt(b)+this._keyStr.charAt(i)+this._keyStr.charAt(l);return g},_utf8_encode:function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",b=0;b<a.length;b++){var h=a.charCodeAt(b);128>h?c+=String.fromCharCode(h):(127<h&&2048>h?c+=String.fromCharCode(h>>6|192):(c+=String.fromCharCode(h>>12|224),c+=String.fromCharCode(h>>6&63|128)),c+=String.fromCharCode(h&63|128))}return c}};return c.encode(a)};b.utf8Encode=function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",d=
0;d<a.length;d++){var b=a.charCodeAt(d);128>b?c+=String.fromCharCode(b):(127<b&&2048>b?c+=String.fromCharCode(b>>6|192):(c+=String.fromCharCode(b>>12|224),c+=String.fromCharCode(b>>6&63|128)),c+=String.fromCharCode(b&63|128))}return c};b.HTTPBuildQuery=function(a,c){var d,g,e=[];"undefined"===typeof c&&(c="&");b.each(a,function(a,c){d=encodeURIComponent(a.toString());g=encodeURIComponent(c);e[e.length]=g+"="+d});return e.join(c)};var F=function(){for(var a=1*new Date,c=0;a==1*new Date;)c++;return a.toString(16)+
c.toString(16)};b.UUID=function(){var a=(screen.height*screen.width).toString(16),c=F()+"-"+Math.random().toString(16).replace(".","")+"-",d;d=function(a,c){var b,d=0;for(b=0;b<c.length;b++)d|=h[b]<<8*b;return a^d};var b,e,h=[],f=0;for(b=0;b<r.length;b++)e=r.charCodeAt(b),h.unshift(e&255),4<=h.length&&(f=d(f,h),h=[]);0<h.length&&(f=d(f,h));d=f.toString(16);return c+d+"-"+a+"-"+F()};b.getQueryParam=function(a,c){var c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),b=RegExp("[\\?&]"+c+"=([^&#]*)").exec(a);
return null===b||b&&"string"!==typeof b[1]&&b[1].length?"":decodeURIComponent(b[1]).replace(/\+/g," ")};var q=function(a){a&&(a.preventDefault=q.preventDefault,a.stopPropagation=q.stopPropagation);return a};q.preventDefault=function(){this.returnValue=!1};q.stopPropagation=function(){this.cancelBubble=!0};b.register_event=function(a,c,d,g){if(a)if(a.addEventListener&&!g)a.addEventListener(c,d,!1);else{var c="on"+c,e=a[c];a[c]=function(c){if(c=c||q(window.event)){var g=!0,f;b.isFunction(e)&&(f=e(c));
c=d.call(a,c);if(!1===f||!1===c)g=!1;return g}}}else k.log("No valid element provided to register_event")};b.info={campaignParams:function(){var a="",c={};b.each(["utm_source","utm_medium","utm_campaign","utm_content","utm_term"],function(d){a=b.getQueryParam(f.URL,d);a.length&&(c[d]=a)});return c},referringDomain:function(a){a=a.split("/");return 3<=a.length?a[2]:""},properties:function(){return b.extend(b.strip_empty_properties({session_screen_size:window.screen.width+"x"+window.screen.height,session_dua:w.userAgent,
session_platform:w.platform,referring_url:f.referrer,referring_domain:b.info.referringDomain(f.referrer)}),{tracker_type:"javascript",tracker_version:"2.1.12"})},pageviewInfo:function(){return b.strip_empty_properties({event_timestamp_epoch:1*new Date,page_url:window.location.protocol+"//"+window.location.host+window.location.pathname,page_title:f.title})}};var p={critical:function(){if(!b.isUndefined(k)&&k){var a=["Cooladata error:"].concat(b.toArray(arguments));try{k.error.apply(k,a)}catch(c){b.each(a,
function(a){k.error(a)})}}}},s=function(a,c,d){var g,f="cooladata"===d?i:i[d];if(f&&!b.isArray(f))k.log("You have already initialized "+d);else return g=new e,g._init(a,c,d),b.isUndefined(f)||g._execute_array(f),g},e=function(){};e.prototype.init=function(a,c,b){if("undefined"===typeof b)k.log("You must name your new library: init(token, config, name)");else if("cooladata"===b)k.log("You must initialize the main cooladata object right after you include the Cooladata js snippet");else return a=s(a,
c,b),i[b]=a,a._loaded(),a};e.prototype._init=function(a){this.__loaded=!0;this.config={};this.set_config(b.extend({},H,{token:a.app_key,img:a.img_src_get_request,session_id:a.session_id,http_post:a.http_post,track_pageload:a.track_pageload,disable_cookie:a.disable_cookie}));a.api_host&&this.set_config({api_host:A+a.api_host});if(a.user_id)this.set_config({user_id:a.user_id});else if(this.get_config("disable_cookie"))this.set_config({user_id:b.UUID()});else{var a=this.get_config("cookie_name"),c=this.getCookie(a);
""==c?(this.setCookie(a),c=this.getCookie(a),""==c?this.set_config({user_id:b.UUID()}):this.set_config({user_id:c})):this.set_config({user_id:c})}this.__dom_loaded_queue=[];this.__request_queue=[]};e.prototype.getCookie=function(a){for(var a=a+"=",c=f.cookie.split(";"),b=0;b<c.length;b++){for(var g=c[b];" "==g.charAt(0);)g=g.substring(1);if(0==g.indexOf(a))return g.substring(a.length,g.length)}return""};e.prototype.setCookie=function(a){var c=this.get_config("cookie_expiration"),d=new Date;d.setTime(d.getTime()+
864E5*c);var c="; expires="+d.toGMTString(),d="com org net int edu gov mil biz".split(" "),g=window.location.host.split("."),e="";if("www"==g[0]||4==g.length)g.shift(),e=g.join(".");else switch(g.length){case 2:e=g.join(".");break;case 3:for(var h=d.length;h--;)if(d[h]===g[2]){g.shift();e=g.join(".");break}""==e&&(e=g.join("."))}f.cookie=a+"="+b.UUID()+c+";domain=."+e+";path=/"};e.prototype._loaded=function(){this.get_config("loaded")(this);this.get_config("track_pageload")&&this.track_pageload()};
e.prototype._dom_loaded=function(){b.each(this.__dom_loaded_queue,function(a){this._track_dom.apply(this,a)},this);b.each(this.__request_queue,function(a){this._send_request.apply(this,a)},this);delete this.__dom_loaded_queue;delete this.__request_queue};e.prototype._track_dom=function(a,b){if(this.get_config("img"))return k.log("You can't use DOM tracking functions with img = true."),!1;if(!x)return this.__dom_loaded_queue.push([a,b]),!1;var d=(new a).init(this);return d.track.apply(d,b)};e.prototype.trackEventLater=
function(a,c){if("undefined"===typeof a)k.log("No event name provided to cooladata.trackEventLater");else{var c=c||{},d=new Date,d=b.extend({},b.info.properties(),b.info.campaignParams(),{event_name:a,event_timestamp_epoch:d.getTime().toString(),event_timezone_offset:-1*(d.getTimezoneOffset()/60),user_id:this.get_config("user_id"),session_id:this.get_config("session_id")}),d=b.extend(d,c);t.push(d)}};e.prototype.flush=function(){this.get_config("api_host");this.get_config("token");var a=b.JSONEncode({events:t});
this._send_request(a);t=[]};e.prototype._send_request=function(a,c){if(y)this.__request_queue.push(arguments);else{var d=!1;1400<a.length&&(d=!0);var e=this.get_config("api_host")+"/v1/"+this.get_config("token")+"/track",i;if(i=!d)i=window.navigator.userAgent,i=(-1<i.indexOf("MSIE ")&&1!==i.split("MSIE ")[1].charAt(0)?!0:!1)||this.get_config("img");if(i)e=this.get_config("api_host")+"/egw/5/"+this.get_config("token")+"/track/__cool.gif",a=b.base64Encode(a),e+="?data="+a,d=f.createElement("img"),d.src=
e,d.setAttribute("onerror",'this.style.width="0";this.style.height="0"'),f.body.appendChild(d);else if(B){i=null;this.get_config("http_post")||d?i="data="+encodeURIComponent(a):(a={data:b.base64Encode(a)},e+="?"+b.HTTPBuildQuery(a));var h=new XMLHttpRequest;this.get_config("http_post")||d?(h.open("POST",e,!0),h.setRequestHeader("Content-type","application/x-www-form-urlencoded")):h.open("GET",e,!0);h.withCredentials=!0;h.onreadystatechange=function(){4===h.readyState&&(200===h.status?c&&c():k.log("Bad HTTP status: "+
h.status+" "+h.statusText))};h.send(i)}else d=f.createElement("script"),d.type="text/javascript",d.async=!0,d.defer=!0,d.src=e,e=f.getElementsByTagName("script")[0],e.parentNode.insertBefore(d,e)}};e.prototype._execute_array=function(a){var c,d=[],e=[],f=[];b.each(a,function(a){a&&(c=a[0],"function"===typeof a?a.call(this):b.isArray(a)&&"alias"===c?d.push(a):b.isArray(a)&&-1!=c.indexOf("track")&&"function"===typeof this[c]?f.push(a):e.push(a))},this);a=function(a,c){b.each(a,function(a){this[a[0]].apply(this,
a.slice(1))},c)};a(d,this);a(e,this);a(f,this)};e.prototype.push=function(a){this._execute_array([a])};e.prototype.trackEvent=function(a,c,d){if("undefined"===typeof a)k.log("No event name provided to cooladata.trackEvent");else{var c=c||{},e=new Date,a=b.extend({},b.info.properties(),b.info.campaignParams(),{event_name:a,event_timestamp_epoch:e.getTime().toString(),event_timezone_offset:-1*(e.getTimezoneOffset()/60),user_id:this.get_config("user_id"),session_id:this.get_config("session_id")}),a=
b.extend(a,c),a={events:[a]},c=b.JSONEncode(a);this._send_request(c,d)}};e.prototype.track_pageload=function(a){"undefined"===typeof a&&(a=f.location.href);this.trackEvent("page_load",b.info.pageviewInfo(a))};e.prototype.set_config=function(a){b.isObject(a)&&b.extend(this.config,a)};e.prototype.get_config=function(a){return this.config[a]};e.prototype.toString=function(){var a=this.get_config("name");"cooladata"!==a&&(a="cooladata."+a);return a};b.toArray=b.toArray;b.isObject=b.isObject;b.JSONEncode=
b.JSONEncode;b.info=b.info;e.prototype.init=e.prototype.init;e.prototype.track_event=e.prototype.trackEvent;e.prototype.track_event_later=e.prototype.trackEventLater;e.prototype.flush=e.prototype.flush;e.prototype.track_pageload=e.prototype.track_pageload;e.prototype.set_config=e.prototype.set_config;e.prototype.get_config=e.prototype.get_config;e.prototype.toString=e.prototype.toString;if(b.isUndefined(i))p.critical("'cooladata' object not initialized. Ensure you are using the latest version of the Cooladata JS Library along with the snippet we provide.");
else if(i.__loaded||i.config)k.log("Cooladata library has already been downloaded at least once.");else if(1.1>o)k.critical("Version mismatch; please ensure you're using the latest version of the Cooladata code snippet.");else{var n={};b.each(i._i,function(a){var c;a&&b.isArray(a)&&(c=a[a.length-1],a=s.apply(this,a),n[c]=a)});i.init=function(a,c,d){d?i[d]||(i[d]=n[d]=s(a,c,d),i[d]._loaded()):(d=i,n.cooladata?d=n.cooladata:a&&(d=s(a,c,"cooladata"),d._loaded()),window.cooladata=i=d,b.each(n,function(a,
b){"cooladata"!==b&&(i[b]=a)}),i._=b)};i.init();b.each(n,function(a){a._loaded()});if(f.addEventListener)"complete"==f.readyState?m():f.addEventListener("DOMContentLoaded",m,!1);else if(f.attachEvent){f.attachEvent("onreadystatechange",m);o=!1;try{o=null==window.frameElement}catch(I){}if(f.documentElement.doScroll&&o){var G=function(){try{f.documentElement.doScroll("left")}catch(a){setTimeout(G,1);return}m()};G()}}b.register_event(window,"load",m,!0)}})(window.cooladata);